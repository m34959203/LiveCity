# LiveCity — Дорожная карта разработки (Demo v0.1)

**Цель:** Довести проект до первой демонстрации.
**Методология:** Канбан-спринты по 1 неделе.
**Дата старта:** Неделя 1 от начала разработки.

---

## Обзор фаз

```
Неделя 1        Неделя 2        Неделя 3        Неделя 4        Неделя 5
──────────────────────────────────────────────────────────────────────────
ФУНДАМЕНТ       BACKEND CORE    FRONTEND CORE   ИНТЕГРАЦИЯ AI   POLISH
Scaffolding      API endpoints   Карта + UI      Gemini Search   Тесты
Database         Seed data       Компоненты      Dashboard AI    Деплой
CI/CD            Score logic     Search UI       Heatmap         Демо
──────────────────────────────────────────────────────────────────────────
```

---

## ФАЗА 1: ФУНДАМЕНТ (Неделя 1)

### Epic 1.1: Инициализация проекта

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 1.1.1 | **Создать Next.js проект** | | |
| | | Инициализировать `create-next-app` с TypeScript и App Router | [ ] |
| | | Настроить `tsconfig.json` (strict mode) | [ ] |
| | | Настроить `next.config.js` | [ ] |
| 1.1.2 | **Настроить Tailwind + shadcn/ui** | | |
| | | Установить и настроить Tailwind CSS | [ ] |
| | | Инициализировать shadcn/ui (`npx shadcn-ui@latest init`) | [ ] |
| | | Добавить базовые компоненты: Button, Card, Input, Sheet, Badge | [ ] |
| 1.1.3 | **Настроить линтинг и форматирование** | | |
| | | Настроить ESLint (Next.js preset + TypeScript) | [ ] |
| | | Настроить Prettier | [ ] |
| | | Добавить `lint-staged` + `husky` для pre-commit hooks | [ ] |
| 1.1.4 | **Настроить переменные окружения** | | |
| | | Создать `.env.example` с описанием всех переменных | [ ] |
| | | Создать `.env.local` (gitignored) | [ ] |
| | | Добавить валидацию env через `zod` или `t3-env` | [ ] |

### Epic 1.2: База данных

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 1.2.1 | **Настроить Prisma + PostgreSQL** | | |
| | | Установить Prisma CLI и клиент | [ ] |
| | | Создать `prisma/schema.prisma` (см. DATABASE_SCHEMA.md) | [ ] |
| | | Настроить подключение к Neon (или локальный Docker PostgreSQL) | [ ] |
| | | Запустить первую миграцию (`prisma migrate dev`) | [ ] |
| 1.2.2 | **Создать seed-данные** | | |
| | | Собрать данные 50-100 заведений Алматы (название, координаты, категория) | [ ] |
| | | Написать `prisma/seed.ts` — заполнение категорий | [ ] |
| | | Написать seed для тегов (Wi-Fi, парковка и др.) | [ ] |
| | | Написать seed для заведений с привязкой к категориям и тегам | [ ] |
| | | Написать seed для score history (30 дней на каждое заведение) | [ ] |
| | | Написать seed для демо-отзывов (5-10 на заведение) | [ ] |
| | | Добавить скрипт `npm run db:seed` | [ ] |
| 1.2.3 | **Настроить Prisma client singleton** | | |
| | | Создать `src/lib/prisma.ts` (избежать множественных соединений в dev) | [ ] |

### Epic 1.3: CI/CD

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 1.3.1 | **GitHub Actions** | | |
| | | Создать `.github/workflows/ci.yml` | [ ] |
| | | Job: lint (ESLint + TypeScript check) | [ ] |
| | | Job: test (Jest/Vitest) | [ ] |
| | | Job: build (Next.js build) | [ ] |
| | | Trigger: push to main + PR | [ ] |
| 1.3.2 | **Настроить деплой на Vercel** | | |
| | | Подключить репозиторий к Vercel | [ ] |
| | | Настроить environment variables в Vercel | [ ] |
| | | Проверить preview deployments для PR | [ ] |

---

## ФАЗА 2: BACKEND CORE (Неделя 2)

### Epic 2.1: API — Заведения

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 2.1.1 | **Создать сервисный слой для заведений** | | |
| | | Реализовать `VenueService.getAll(filters)` — с пагинацией и фильтрами | [ ] |
| | | Реализовать `VenueService.getById(id)` — с включением тегов и отзывов | [ ] |
| | | Реализовать `VenueService.getByBounds(bbox)` — геопространственный запрос | [ ] |
| | | Написать TypeScript-типы для Venue, VenueFilters, VenueDetail | [ ] |
| 2.1.2 | **Создать API route: GET /api/venues** | | |
| | | Реализовать парсинг query parameters (bounds, category, tag, minScore) | [ ] |
| | | Подключить VenueService | [ ] |
| | | Добавить валидацию входных данных (zod) | [ ] |
| | | Формат ответа согласно API_SPEC.md | [ ] |
| 2.1.3 | **Создать API route: GET /api/venues/:id** | | |
| | | Реализовать получение детальной информации | [ ] |
| | | Включить теги, последние отзывы, фото | [ ] |
| | | Обработка 404 | [ ] |
| 2.1.4 | **Создать API route: GET /api/categories** | | |
| | | Список категорий с количеством заведений | [ ] |

### Epic 2.2: Live Score Engine

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 2.2.1 | **Создать ScoreService** | | |
| | | Реализовать формулу расчёта Live Score (см. ARCHITECTURE.md) | [ ] |
| | | Модификатор по времени суток (утро/день/вечер/ночь) | [ ] |
| | | Модификатор по дню недели (будни/выходные) | [ ] |
| | | Функция обновления score для всех заведений (batch update) | [ ] |
| 2.2.2 | **Для демо: упрощённый score** | | |
| | | Score из seed-данных + рандом ±0.5 с привязкой к текущему часу | [ ] |
| | | Обновление score при каждом запросе (или по таймеру) | [ ] |

### Epic 2.3: Heatmap API

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 2.3.1 | **Создать API route: GET /api/heatmap** | | |
| | | Агрегация score по гео-кластерам | [ ] |
| | | Поддержка параметра resolution (low/medium/high) | [ ] |
| | | Формат ответа: массив {lat, lng, weight} | [ ] |

---

## ФАЗА 3: FRONTEND CORE (Неделя 3)

### Epic 3.1: Layout и навигация

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 3.1.1 | **Создать корневой layout** | | |
| | | Реализовать `src/app/layout.tsx` — шрифты, meta, global styles | [ ] |
| | | Добавить favicon и OG-теги (для шаринга ссылки) | [ ] |
| 3.1.2 | **Создать header/navigation** | | |
| | | Лого LiveCity | [ ] |
| | | Навигация: Карта / Дашборд | [ ] |
| | | Адаптивность (mobile hamburger menu) | [ ] |

### Epic 3.2: Карта (Map View)

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 3.2.1 | **Установить и настроить Mapbox** | | |
| | | Установить `react-map-gl` и `mapbox-gl` | [ ] |
| | | Настроить Mapbox token и стиль карты | [ ] |
| | | Создать `MapView.tsx` — полноэкранная карта, центр на Алматы | [ ] |
| 3.2.2 | **Маркеры заведений** | | |
| | | Создать `VenueMarker.tsx` — кастомный маркер с Live Score | [ ] |
| | | Цветовая индикация (зелёный/жёлтый/серый) | [ ] |
| | | Кластеризация маркеров при zoom-out | [ ] |
| | | Анимация при hover и click | [ ] |
| 3.2.3 | **Тепловой слой** | | |
| | | Создать `HeatmapLayer.tsx` — Mapbox heatmap layer | [ ] |
| | | Toggle-переключатель «Маркеры / Тепловая карта» | [ ] |
| | | Подключить данные из `/api/heatmap` | [ ] |
| 3.2.4 | **Контролы карты** | | |
| | | Кнопка «Моё местоположение» (Geolocation API) | [ ] |
| | | Кнопки zoom +/- | [ ] |
| | | Фильтр по категориям (chips) | [ ] |

### Epic 3.3: Карточка заведения

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 3.3.1 | **Создать VenueDetails (Sheet panel)** | | |
| | | Выезжающая панель снизу (mobile) / справа (desktop) | [ ] |
| | | Шапка: название + Live Score badge + категория | [ ] |
| | | Фото-карусель (swiper) | [ ] |
| | | Адрес + кнопка «Маршрут» (Google Maps link) | [ ] |
| | | Теги (badges) | [ ] |
| | | Часы работы (collapsible) | [ ] |
| | | AI-описание | [ ] |
| | | Кнопка «Написать в WhatsApp» (Direct Connect) | [ ] |
| 3.3.2 | **Создать LiveScoreBadge** | | |
| | | Круглый бейдж с числом 0-10 | [ ] |
| | | Градиентная цветовая шкала | [ ] |
| | | Анимация при обновлении | [ ] |

### Epic 3.4: Строка поиска

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 3.4.1 | **Создать SearchBar** | | |
| | | Floating search bar поверх карты | [ ] |
| | | Placeholder с примерами запросов | [ ] |
| | | Индикатор загрузки (skeleton / spinner) | [ ] |
| | | Debounce ввода (300ms) | [ ] |
| 3.4.2 | **Создать SearchResults** | | |
| | | Список карточек с результатами под поисковой строкой | [ ] |
| | | Поле «reason» — почему AI выбрал это место | [ ] |
| | | Клик по результату → zoom на карте + открытие VenueDetails | [ ] |
| | | Состояния: loading / results / empty / error | [ ] |

---

## ФАЗА 4: AI-ИНТЕГРАЦИЯ (Неделя 4)

### Epic 4.1: Gemini AI Service

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 4.1.1 | **Создать AIService** | | |
| | | Установить `@google/generative-ai` SDK | [ ] |
| | | Создать `src/lib/gemini.ts` — клиент с конфигурацией | [ ] |
| | | Реализовать интерфейс `AIProvider` (для будущей замены провайдера) | [ ] |
| 4.1.2 | **Реализовать Semantic Search** | | |
| | | Составить системный промпт для Gemini (роль, контекст, формат ответа) | [ ] |
| | | Реализовать `AIService.semanticSearch(query, venues, location)` | [ ] |
| | | Передача контекста заведений в промпт (название, категория, теги, адрес, score) | [ ] |
| | | Парсинг JSON-ответа Gemini → ranked venue IDs + reasons | [ ] |
| | | Обработка ошибок и таймаутов Gemini API | [ ] |
| | | Rate limiting (не более 10 запросов/мин для демо) | [ ] |
| 4.1.3 | **Создать API route: POST /api/search** | | |
| | | Валидация запроса (query не пустой, location опциональна) | [ ] |
| | | Загрузка контекста заведений из БД | [ ] |
| | | Вызов AIService.semanticSearch | [ ] |
| | | Обогащение результатов данными из БД | [ ] |
| | | Формат ответа согласно API_SPEC.md | [ ] |

### Epic 4.2: AI Dashboard (Бизнес-аналитика)

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 4.2.1 | **Реализовать AnalyticsService** | | |
| | | `getScoreHistory(venueId, days)` — история из score_history | [ ] |
| | | `getTopComplaints(venueId)` — AI-группировка отзывов через Gemini | [ ] |
| | | `getActionPlan(venueId)` — AI-генерация 3 рекомендаций | [ ] |
| | | `getDistrictComparison(venueId)` — среднее по району из БД | [ ] |
| 4.2.2 | **Создать API route: GET /api/dashboard/:venueId** | | |
| | | Объединить все данные AnalyticsService | [ ] |
| | | Кеширование ответа (revalidate: 300 sec) | [ ] |
| 4.2.3 | **Создать страницу /dashboard** | | |
| | | Создать `src/app/dashboard/page.tsx` | [ ] |
| | | Компонент `ScoreChart` — линейный график (recharts или chart.js) | [ ] |
| | | Компонент `ComplaintsList` — карточки с жалобами и трендами | [ ] |
| | | Компонент `ActionPlan` — нумерованный список рекомендаций | [ ] |
| | | Компонент `DistrictComparison` — сравнительная карточка | [ ] |
| | | Для демо: хардкод venueId одного заведения | [ ] |

---

## ФАЗА 5: POLISH & DEPLOY (Неделя 5)

### Epic 5.1: Тестирование

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 5.1.1 | **Настроить тестовый фреймворк** | | |
| | | Установить Vitest (или Jest) + React Testing Library | [ ] |
| | | Настроить `vitest.config.ts` | [ ] |
| | | Добавить скрипт `npm run test` | [ ] |
| 5.1.2 | **Unit-тесты (сервисный слой)** | | |
| | | Тесты для ScoreService.calculateLiveScore | [ ] |
| | | Тесты для VenueService.getByBounds | [ ] |
| | | Тесты для парсинга ответа Gemini | [ ] |
| 5.1.3 | **API-тесты** | | |
| | | Тест GET /api/venues — с фильтрами и без | [ ] |
| | | Тест GET /api/venues/:id — success + 404 | [ ] |
| | | Тест POST /api/search — валидный запрос + ошибки | [ ] |
| 5.1.4 | **Smoke-тесты UI** | | |
| | | Рендер MapView без ошибок | [ ] |
| | | Рендер SearchBar + ввод запроса | [ ] |
| | | Рендер VenueDetails с данными | [ ] |

### Epic 5.2: UX Polish

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 5.2.1 | **Loading states** | | |
| | | Skeleton для списка заведений | [ ] |
| | | Spinner для AI-поиска | [ ] |
| | | Placeholder для карты при загрузке | [ ] |
| 5.2.2 | **Error states** | | |
| | | Ошибка загрузки карты (fallback) | [ ] |
| | | Ошибка AI-поиска (retry button) | [ ] |
| | | Пустые результаты поиска (иллюстрация) | [ ] |
| 5.2.3 | **Анимации и микроинтеракции** | | |
| | | Плавное появление маркеров на карте | [ ] |
| | | Анимация выезда панели заведения | [ ] |
| | | Hover-эффекты на карточках | [ ] |
| 5.2.4 | **Responsive design** | | |
| | | Адаптация карты для мобильного экрана | [ ] |
| | | Bottom sheet для VenueDetails на мобиле | [ ] |
| | | Адаптация дашборда для планшета | [ ] |

### Epic 5.3: Деплой и подготовка демо

| ID | Задача | Подзадачи | Статус |
|---|---|---|---|
| 5.3.1 | **Production деплой** | | |
| | | Настроить production environment variables в Vercel | [ ] |
| | | Запустить seed на production БД (Neon) | [ ] |
| | | Проверить все API endpoints на production | [ ] |
| | | Проверить работу Gemini API на production | [ ] |
| | | Проверить производительность (Lighthouse audit) | [ ] |
| 5.3.2 | **Подготовка демо-сценария** | | |
| | | Написать скрипт демонстрации (2-3 минуты) | [ ] |
| | | Подготовить «красивые» запросы для AI-поиска | [ ] |
| | | Убедиться, что seed-данные дают впечатляющие результаты | [ ] |
| | | Протестировать full demo flow 3 раза без сбоев | [ ] |
| 5.3.3 | **Фоллбеки для демо** | | |
| | | Скриншоты ключевых экранов (если упадёт интернет) | [ ] |
| | | Fallback-ответы AI (захардкоженные) если Gemini API тормозит | [ ] |
| | | Локальный запуск как backup | [ ] |

---

## Суммарная статистика задач

| Фаза | Эпики | Задачи | Подзадачи |
|---|---|---|---|
| 1. Фундамент | 3 | 8 | 24 |
| 2. Backend Core | 3 | 7 | 20 |
| 3. Frontend Core | 4 | 10 | 30 |
| 4. AI-интеграция | 2 | 7 | 23 |
| 5. Polish & Deploy | 3 | 9 | 25 |
| **ИТОГО** | **15** | **41** | **122** |

---

## Зависимости между фазами

```
Фаза 1 (Фундамент)
  ├── 1.1 Scaffolding ──────────→ Всё остальное зависит от этого
  ├── 1.2 Database ─────────────→ Фаза 2 (Backend)
  └── 1.3 CI/CD ────────────────→ Фаза 5 (Deploy)

Фаза 2 (Backend)
  ├── 2.1 Venues API ───────────→ Фаза 3 (Frontend: карта + карточки)
  ├── 2.2 Score Engine ─────────→ Фаза 3 (Frontend: маркеры)
  └── 2.3 Heatmap API ─────────→ Фаза 3 (Frontend: тепловая карта)

Фаза 3 (Frontend) ─────────────→ Фаза 5 (Polish)

Фаза 4 (AI) зависит от:
  ├── 2.1 Venues API (данные для промпта)
  └── 3.4 SearchBar (UI для поиска)
  → Может частично идти параллельно с Фазой 3

Фаза 5 (Polish) зависит от:
  └── Все предыдущие фазы
```

---

## Распределение работы (для команды из 2-3 человек)

### Вариант A: 2 разработчика

| Неделя | Dev 1 (Fullstack/Backend) | Dev 2 (Frontend) |
|---|---|---|
| 1 | 1.1 Scaffolding + 1.2 Database | 1.1 (помощь) + 1.3 CI/CD |
| 2 | 2.1 Venues API + 2.2 Score | Дизайн UI компонентов (Figma/код) |
| 3 | 2.3 Heatmap + начало 4.1 AI | 3.1 Layout + 3.2 Карта + 3.3 Карточки |
| 4 | 4.1 AI Service + 4.2 Dashboard API | 3.4 Поиск + 4.2.3 Dashboard UI |
| 5 | 5.1 Тесты + 5.3 Деплой | 5.2 UX Polish + 5.3.2 Демо-сценарий |

### Вариант B: 1 разработчик (solo)

Приоритет: двигаться вертикально — сделать одну фичу целиком (backend + frontend), потом следующую.

| Неделя | Фокус |
|---|---|
| 1 | Scaffolding + Database + Seed |
| 2 | Venues API + Карта + Маркеры (vertical slice) |
| 3 | Карточка заведения + Heatmap (vertical slice) |
| 4 | AI Search (Gemini + API + UI) |
| 5 | Dashboard + Polish + Деплой |

---

## Definition of Done (для каждой задачи)

- [ ] Код написан и работает
- [ ] TypeScript — нет ошибок типизации
- [ ] ESLint — нет ошибок
- [ ] Базовые тесты написаны (где применимо)
- [ ] Code review пройден (self-review для solo)
- [ ] Задача закрыта в трекере
