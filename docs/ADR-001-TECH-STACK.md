# ADR-001: Выбор технологического стека

**Статус:** Принято
**Дата:** 2026-02-18
**Участники:** Команда LiveCity

---

## Контекст

LiveCity — платформа городской навигации с AI-ядром. Для первой демонстрации нужен стек, который позволит:
- Быстро запустить работающий прототип (4-6 недель)
- Показать карту с заведениями и Live Score
- Продемонстрировать AI-поиск на естественном языке
- Легко масштабировать после демо

## Решение

### Frontend + Backend: Next.js 14 (App Router) + TypeScript

**Почему:**
- Единый язык (TypeScript) для frontend и backend — меньше переключений контекста
- API Routes позволяют держать backend внутри одного проекта на этапе MVP
- SSR/SSG для SEO (важно для будущего органического трафика)
- Огромная экосистема React-компонентов для карт, графиков, UI
- Деплой на Vercel в один клик

**Альтернативы (отклонены):**
| Вариант | Причина отклонения |
|---|---|
| React SPA + Express | Два отдельных проекта — медленнее для MVP |
| Vue/Nuxt | Меньше готовых компонентов для карт и AI |
| React Native (mobile-first) | Демо проще показать в браузере, мобилка — post-MVP |

### База данных: PostgreSQL + Prisma ORM

**Почему:**
- PostgreSQL: расширения PostGIS для геопространственных запросов (критично для карты)
- Prisma: type-safe ORM, автогенерация типов, миграции из коробки
- Надёжность и масштабируемость PostgreSQL проверена индустрией

**Альтернативы (отклонены):**
| Вариант | Причина отклонения |
|---|---|
| MongoDB | Слабее для геопространственных JOIN-запросов |
| Supabase | Vendor lock-in, меньше контроля |
| Drizzle ORM | Менее зрелая экосистема |

### AI: Google Gemini API

**Почему:**
- Упомянут в Vision как основной AI-провайдер
- Мощные возможности для NLP/semantic search
- Конкурентные цены для стартапа
- Хорошая поддержка мультиязычности (русский, казахский)

**Mitigation (снижение рисков):**
- Абстрагировать AI-вызовы через сервисный слой (интерфейс `AIProvider`)
- В будущем: возможность подключить OpenAI/Anthropic как fallback

### Карты: Mapbox GL JS

**Почему:**
- Лучший SDK для кастомных карт с heatmap-слоями
- Поддержка 3D, кластеризации, анимаций — для wow-эффекта на демо
- Бесплатный tier: 50,000 загрузок карт/месяц (достаточно для MVP)
- React-обёртка `react-map-gl`

**Альтернативы (отклонены):**
| Вариант | Причина отклонения |
|---|---|
| Google Maps | Дороже, менее кастомизируемый |
| Leaflet | Слабее для heatmap и 3D |
| 2GIS API | Ограниченная кастомизация |

### UI: Tailwind CSS + shadcn/ui

**Почему:**
- Tailwind: быстрая стилизация без CSS-файлов
- shadcn/ui: готовые accessible-компоненты (не библиотека, а копируемый код — полный контроль)
- Единый design system из коробки

### Деплой (Demo): Vercel + Neon (Serverless PostgreSQL)

**Почему:**
- Vercel: zero-config деплой Next.js, preview-ветки, CDN
- Neon: serverless PostgreSQL с PostGIS, бесплатный tier
- Весь стек запускается бесплатно для демо

---

## Итоговый стек

```
┌─────────────────────────────────────────┐
│              FRONTEND                    │
│  Next.js 14 + TypeScript                │
│  React 18 + Tailwind CSS + shadcn/ui    │
│  react-map-gl (Mapbox GL JS)            │
├─────────────────────────────────────────┤
│              BACKEND (API Routes)        │
│  Next.js API Routes + TypeScript        │
│  Prisma ORM                             │
│  Google Gemini AI SDK                   │
├─────────────────────────────────────────┤
│              DATA                        │
│  PostgreSQL + PostGIS (Neon)            │
│  Prisma Migrations                      │
├─────────────────────────────────────────┤
│              INFRA                       │
│  Vercel (hosting)                       │
│  GitHub Actions (CI/CD)                 │
│  Neon (database)                        │
└─────────────────────────────────────────┘
```

## Последствия

**Положительные:**
- Один язык (TypeScript) — быстрая разработка
- Бесплатный деплой для демо-стадии
- Гео-запросы через PostGIS
- Готовые UI-компоненты ускоряют фронтенд

**Отрицательные:**
- Next.js API Routes не заменят полноценный backend при масштабировании (миграция на отдельный сервис позже)
- Зависимость от Vercel для деплоя (можно мигрировать на Docker + VPS)
