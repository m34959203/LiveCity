# ADR-001: Выбор технологического стека

**Статус:** Принято и реализовано
**Дата:** 2026-02-18
**Участники:** Команда LiveCity

---

## Контекст

LiveCity — платформа городской навигации с AI-ядром. Для первой демонстрации нужен стек, который позволит быстро запустить прототип с картой, AI-поиском и бизнес-аналитикой.

## Финальный стек (реализован)

### Frontend + Backend: Next.js 16 (App Router) + TypeScript (strict)

**Почему:**
- Единый язык (TypeScript) для frontend и backend
- API Routes позволяют держать backend внутри одного проекта
- React 19 с Server Components
- Деплой на Vercel в один клик

**Альтернативы (отклонены):**
| Вариант | Причина отклонения |
|---|---|
| React SPA + Express | Два отдельных проекта — медленнее для MVP |
| Vue/Nuxt | Меньше готовых компонентов для карт и AI |

### База данных: PostgreSQL + Prisma 6

**Почему:**
- PostgreSQL: надёжность, геопространственные запросы через индексы (lat/lng)
- Prisma 6: type-safe ORM, автогенерация типов, миграции

**Примечание:** Изначально планировался Prisma 7, но из-за breaking changes (удалён `url` в datasource) откатились на Prisma 6.

**Альтернативы (отклонены):**
| Вариант | Причина отклонения |
|---|---|
| MongoDB | Слабее для реляционных JOIN-запросов |
| Drizzle ORM | Менее зрелая экосистема |

### AI: Google Gemini 2.0 Flash

**Почему:**
- Быстрая модель для real-time поиска
- Хорошая поддержка русского языка
- Конкурентные цены

**Использование (3 точки):**
1. Semantic Search — ранжирование заведений по NL-запросу
2. Action Plan — генерация 3 рекомендаций для бизнеса
3. Complaint Grouping — группировка негативных отзывов по темам

### Карты: Mapbox GL JS (react-map-gl v8)

**Почему:**
- Лучший SDK для кастомных карт с heatmap
- Стиль `dark-v11` — визуально впечатляющий для демо
- Бесплатный tier: 50,000 загрузок/месяц

**Альтернативы (отклонены):**
| Вариант | Причина отклонения |
|---|---|
| Google Maps | Дороже, менее кастомизируемый |
| Leaflet | Слабее для heatmap |

### UI: Tailwind CSS 4

**Почему:**
- Utility-first — быстрая стилизация
- v4: встроенная поддержка в Next.js, нет отдельного tailwind.config

**Примечание:** Отказались от shadcn/ui в пользу кастомных компонентов для большего контроля.

### Графики: Recharts

- LineChart для Score History (30 дней) на дашборде

### Тестирование: Vitest + React Testing Library

**Почему:**
- Vitest: нативная ESM-поддержка, совместимость с Vite
- React Testing Library: тестирование поведения, а не реализации
- 37 тестов: сервисы, компоненты, type contracts

### CI/CD: GitHub Actions

3 jobs: Lint & Typecheck, Tests, Build.

---

## Итоговый стек

```
┌─────────────────────────────────────────┐
│              FRONTEND                    │
│  Next.js 16 + TypeScript (strict)       │
│  React 19 + Tailwind CSS 4             │
│  react-map-gl v8 (Mapbox dark-v11)     │
│  Recharts (LineChart)                   │
├─────────────────────────────────────────┤
│              BACKEND (API Routes)        │
│  Next.js App Router API Routes          │
│  Prisma 6 ORM                           │
│  Google Gemini 2.0 Flash SDK           │
├─────────────────────────────────────────┤
│              DATA                        │
│  PostgreSQL                             │
│  Prisma Migrations + Seed              │
├─────────────────────────────────────────┤
│              TESTING                     │
│  Vitest + React Testing Library         │
│  37 тестов (services + components)      │
├─────────────────────────────────────────┤
│              INFRA                       │
│  Vercel (hosting)                       │
│  GitHub Actions (3 CI jobs)             │
└─────────────────────────────────────────┘
```

## Последствия

**Положительные:**
- Один язык (TypeScript) — быстрая разработка
- Бесплатный деплой для демо
- 37 тестов обеспечивают стабильность
- Все 5 фаз разработки завершены в срок

**Отрицательные:**
- Next.js API Routes не заменят полноценный backend при масштабировании
- Зависимость от Vercel (миграция на Docker + VPS возможна)
